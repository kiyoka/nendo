#!/bin/sh
:; #-*- mode: nendo; syntax: scheme -*-;;
:; exec /usr/local/bin/nendo $0 $*

;; print the peek memory usage of this process.
(define (print-peek-memory)
  (with-open "|cat /proc/#{Process.pid}/status"
             (lambda (f)
               (print (+ "=> " (car (to-list (f.readlines.grep #/vmpeak/i))))))))

(define (main argv)
  (with-open
   "bigdata.txt"
   (lambda (f)
     (let* ((lines (f.lines.lazy))
            (lst   (map
                    (lambda (line)
                      (+ "<" line.chomp ">"))
                    lines)))
       (printf "lst.class=%s\n" (lst.class.to_s))
       (for-each print lst))))

  (print-peek-memory))



